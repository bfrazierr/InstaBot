!function(){var a=function(){function c(){var c=$("body");c.on("click",".ext_del_btn",function(c){var d=this.dataset.shortcode,e=a.getModalBox();e.showDeleteWarning({continueDelCallback:b.deleteMedia(d)})})}function d(){setInterval(function(){var a=document.querySelector('main header section a[href="/accounts/edit/"]');if(a&&(setTimeout(function(){b.uploadStateInit(a.parentElement.parentElement)},0),a&&-1==window.location.href.indexOf("/saved/"))){var c=document.querySelectorAll('section > main article > div > div > div a[href^="/p/"]');0==c.length&&document.querySelector('article > div > div > div a[href^="/p/"] img')&&(c=document.querySelectorAll('article > div > div > div a[href^="/p/"]')),0==c.length&&document.querySelector('section div > div > div a[href^="/p/"] img')&&(c=document.querySelectorAll('section div > div > div a[href^="/p/"]')),c&&c.forEach&&c.forEach(function(a){a.parentNode.dataset.dlBtnSkip||b.addDeleteBtnToThumbnail(a)})}},1e3)}function e(){"undefined"==typeof NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),"undefined"==typeof HTMLCollection.prototype.forEach&&(HTMLCollection.prototype.forEach=Array.prototype.forEach)}return{lastButtonClick:0,authorizedUserName:null,run:function(){e(),d(),c(),this.checkExternalUpload(),this.rememberLastUser()},checkExternalUpload:function(){var c=this,d=window.location.search.match(/insta_upload_el=1/);if(d){var e=window.location.href.match(/instagram\.com\/([^\/]+)/);e=e&&e[1],e&&c.getUserNameFromSharedData(function(d){d&&d==e&&c.getExternalUploadLink(function(d){d&&c.isValidLink(d)&&c.requestExternalFile(d,function(c){var d=c.target.result,e=a.getModalBox();e.showUploadChoice({toProfileCallback:function(){b.uploadType="profile",b.uploadPreviewBlock.create(d)},toStoriesCallback:function(){b.uploadType="story",b.uploadPreviewBlock.create(d)}})})})})}},rememberLastUser:function(){this.getUserNameFromSharedData(function(a){a&&chrome.runtime.sendMessage({action:"last_authorized_user",username:a})})},isValidLink:function(a){return!!a.match(/^https?:\/\/(www\.)?[^\.]+\.[^\.]+/)},getUserNameFromSharedData:function(a){var b=this;b.requestHTMLgraphqlMain(function(c){if(!c||!c.length)return a(null);var d=b.get_sharedDataFromHTML(c,"https://www.instagram.com"),e=d&&d.config&&d.config.viewer&&d.config.viewer.username;a(e)})},requestHTMLgraphqlMain:function(a){var b="https://www.instagram.com/";$.ajax(b).done(function(b){return b&&b.length&&/_sharedData/.test(b)?void a(b):a()}).fail(function(b){a()})},requestJSONgraphqlByShortCode:function(b,c){b=b||{};var d=b.shortCode;if("string"==typeof d&&d.length&&"function"==typeof c){var e="https://www.instagram.com/p/"+d+"/?__a=1";return $.ajax({url:e,dataType:"json"}).done(function(b){var f;if(/^<!DOCTYPE\s+html>/.test(b)){var g=a.get_sharedDataFromHTML(b,e);g&&(f=a.getGraphQlFromSharedData(g,e))}else if("object"!=typeof b)try{f=JSON.parse(b)}catch(h){}else f=b;return f&&f.graphql&&f.graphql.shortcode_media?void c(f):a.requestHTMLgraphqlByShortCode(d,c)}).fail(function(b){return a.requestHTMLgraphqlByShortCode(d,c)})}},requestHTMLgraphqlByShortCode:function(b,c){if("string"==typeof b&&"function"==typeof c){var d="https://www.instagram.com/p/"+b+"/";$.ajax(d).done(function(b){if(!b||!b.length||!/_sharedData/.test(b))return c({error:1});var e=a.get_sharedDataFromHTML(b,d);if(!e)return c({error:1});var f=a.getGraphQlFromSharedData(e,d);return f&&f.graphql?void c(f):c({error:1})}).fail(function(a){return c({error:1})})}},get_sharedDataFromHTML:function(a,b){var c,d;if("string"!=typeof a||!a.length)return null;a=a.replace(/[\r\n\t\s]/g,"");var e=a.indexOf("window._sharedData");if(-1==e)return null;var f=a.indexOf("</script>",e);if(-1==f)return null;var g=a.substr(e,f-e);if(c=g.match(/({.+);$/),c=c&&c[1],!c)return null;try{d=JSON.parse(c)}catch(h){}return d?d:null},getGraphQlFromSharedData:function(a,b){return a&&"object"==typeof a&&a.entry_data?a.entry_data.PostPage?a.entry_data.PostPage[0]:a.entry_data.ProfilePage?a.entry_data.ProfilePage[0]:a.entry_data.FeedPage?a.entry_data.FeedPage[0]:a.entry_data.LandingPage?a.entry_data.LandingPage[0]:null:null},getExternalUploadLink:function(a){chrome.runtime.sendMessage("get_external_link",a)},requestExternalFile:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){if(4===this.readyState&&200===this.status)try{var a=this.response||this.responseText,c=new Blob([a],{type:"application/octet-stream"}),d=new FileReader;d.onload=b,d.readAsDataURL(c)}catch(e){}},c.send()},getModalBox:function(){function a(){j(),l.style.display="none",r.innerHTML="",l.opened=0}function b(b){return function(){a(),b()}}function c(b){return function(){a(),b()}}function d(b){return function(){a(),b()}}function e(a){return function(){a(l)}}function f(){a()}function g(b){b.target==l&&a()}function h(a){27==a.keyCode&&f()}function i(a,b,c){a&&b&&c&&a.addEventListener(b,c),s.push({el:a,event:b,listener:c})}function j(){s.forEach(function(a){a.el&&a.event&&a.listener&&a.el.removeEventListener(a.event,a.listener)}),window.removeEventListener("click",g),window.removeEventListener("keydown",h)}function k(a){m=l.querySelector(".ext_btn_continue"),n=l.querySelector(".ext_btn_cancel"),o=r.querySelector(".ext_modal_close"),p=r.querySelector(".upload_to_profile_btn"),q=r.querySelector(".upload_to_stories_btn"),a&&"function"==typeof a.continueCallback&&i(m,"click",b(a.continueCallback)),a&&"function"==typeof a.continueDelCallback&&i(m,"click",e(a.continueDelCallback)),a&&"function"==typeof a.toProfileCallback&&i(p,"click",c(a.toProfileCallback)),a&&"function"==typeof a.toStoriesCallback&&i(q,"click",d(a.toStoriesCallback)),i(n,"click",f),i(o,"click",f),window.addEventListener("keydown",h)}var l=document.querySelector(".ext_modal");l||(l=document.createElement("div"),l.className="ext_modal",l.innerHTML='<div class="ext_modal_content"></div>',document.body.appendChild(l));var m,n,o,p,q,r=l.querySelector(".ext_modal_content"),s=[];return l.close=function(){a()},l.showDeleteWarning=function(a){r.innerHTML='<div class="ext_modal_header">'+chrome.i18n.getMessage("are_you_sure_delete")+'</div><div class="ext_modal_buttons_wrap"><button class="ext_btn_continue">'+chrome.i18n.getMessage("delete").toUpperCase()+'</button><button class="ext_btn_cancel">'+chrome.i18n.getMessage("btn_cancel").toUpperCase()+"</button></div>",k(a),window.addEventListener("click",g),l.style.display="block",l.opened=1},l.showErrorBox=function(a){r.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_error_modal_wrap"><div class="ext_error_modal_text">'+a+"</div></div>",k(),window.addEventListener("click",g),l.opened=1,l.style.display="block"},l.showUploadChoice=function(a){r.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_buttons_wrap"><button class="upload_to_profile_btn">'+chrome.i18n.getMessage("upload_to_profile")+'</button><button class="upload_to_stories_btn">'+chrome.i18n.getMessage("upload_to_stories")+"</button></div>",k(a),window.addEventListener("click",g),l.style.display="block",l.opened=1},l.showSuccessText=function(a){r.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_just_text_wrap"><span>'+a+"</span></div>",k(),window.addEventListener("click",g),l.style.display="block",l.opened=1},l.showUsersListSearch=function(a){r.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_users_search_wrap"></div><div class="ext_users_search_list"></div>',k(a),window.addEventListener("click",g),l.style.display="block",l.opened=1},l.opened=0,r.innerHTML="",l}}}(),b=function(){function c(a,b){if(a.files&&a.files[0]){var c=new FileReader;c.onload=b,c.readAsDataURL(a.files[0])}}function d(a){if(!a)return!1;if(a.querySelector(".ext_upload_icon"))return!1;var b=document.querySelector("section main section");return!(!b||!b.querySelector('a[href="/accounts/edit/"]'))}return{stepNow:null,delButtonTemplate:null,delBtnClassName:"ext_del_btn",uploadType:void 0,uploadId:void 0,size:null,confirmedUsertags:[],uploadStateInit:function(a){d(a)&&(this.uploadBtn.create(a),this.form.create())},stateReset:function(){this.uploadType=void 0,this.uploadId=void 0,this.stepNow=null,this.size=null,this.form.reset(),this.uploadPreviewBlock.destroySelf(),this.uploadBtn.enable(),this.uploadPreviewBlock.tagPeople.usertags=[],this.uploadPreviewBlock.tagPeople.listenersAdded=!1,this.uploadPreviewBlock.tagPeople.usersList.suggestedUsers=null,this.confirmedUsertags=[]},uploadBtn:{arrowEl:null,uploadBtnEl:null,disabled:!1,create:function(a){if(a){var b=this,c=document.createElement("div");c.className="upload_btn_wrap";var d=document.createElement("button");d.className="ext_upload_icon";var e=document.createElement("span");if(e.className="ext_tooltip upload",e.innerText=chrome.i18n.getMessage("upload_file"),c.appendChild(e),c.appendChild(d),a.appendChild(c),b.uploadBtnEl=d,window.location.href.indexOf("#upload")>-1){var f=document.createElement("span");f.className="upload_help_arrow",c.appendChild(f),b.arrowEl=f,b.arrowAnimate()}d.addEventListener("click",b.uploadBtnOnClick.bind(b)),b.enable()}},uploadBtnOnClick:function(){var c=this;if(!this.disabled){c.arrowEl&&(c.arrowEl.style.display="none");var d=a.getModalBox();d.showUploadChoice({toProfileCallback:function(){b.uploadType="profile",b.form.inputDispatchClick()},toStoriesCallback:function(){b.uploadType="story",b.form.inputDispatchClick()}})}},arrowAnimate:function(){if(this.arrowEl){var a=this;setTimeout(function(){a.arrowEl.style.transition="none";var b=700;$(a.arrowEl).animate({opacity:1},200).animate({right:"-80px"},b).animate({right:"-120px"},b).animate({right:"-80px"},b).animate({right:"-120px"},b).animate({right:"-80px"},b).animate({right:"-120px"},b).animate({right:"-80px",opacity:0},b,function(){a.arrowEl.style.display="none"})},200)}},enable:function(){this.uploadBtnEl.classList.remove("disabled"),this.disabled=!1},disable:function(){this.uploadBtnEl.classList.add("disabled"),this.disabled=!0}},form:{formEl:null,inputEl:null,create:function(){var a=document.createElement("form"),b=document.createElement("input");a.id="ext_upload_form",a.setAttribute("enctype","multipart/form-data"),b.id="ext_upload_input",b.setAttribute("type","file"),b.setAttribute("name","photo"),b.setAttribute("accept","image/*"),a.appendChild(b),document.body.appendChild(a),b.addEventListener("change",this.onInputChange),this.formEl=a,this.inputEl=b},reset:function(){this.formEl&&this.formEl.reset()},inputDispatchClick:function(){this.inputEl&&this.inputEl&&this.inputEl.click()},onInputChange:function(){c(this,function(a){var c=a.target.result;b.uploadPreviewBlock.create(c)})}},uploadRequest:{factory:function(c,d,e){var f=this;"photo"==c?f.sendPhoto(d,function(c){c.error?(f.handleBadResponse(c),b.stateReset()):(b.uploadId=c.upload_id,"profile"==b.uploadType?"function"==typeof e&&e():f.configurePhoto({caption:"",uploadId:b.uploadId,uploadType:b.uploadType},function(c){if(c.error)f.handleBadResponse(c),b.stateReset();else{var d=a.getModalBox(),e=chrome.i18n.getMessage("story_is_added");d.showSuccessText(e),b.stateReset()}}))}):"caption"==c&&f.configurePhoto({caption:d,uploadId:b.uploadId,uploadType:b.uploadType,usertags:b.confirmedUsertags},function(a){a.error?(f.handleBadResponse(a),b.stateReset()):window.location=window.location.origin+window.location.pathname})},sendPhoto:function(a,c){chrome.runtime.sendMessage("getCookies",function(d){if(d){var e=b.size&&b.size.width||1080,f=b.size&&b.size.height||1080,g=(new Date).getTime(),h="https://www.instagram.com/rupload_igphoto/fb_uploader_"+g,i=new XMLHttpRequest;i.open("POST",h,!0),i.setRequestHeader("x-csrftoken",d.csrftoken),i.setRequestHeader("x-entity-length",a.size),i.setRequestHeader("x-entity-name","fb_uploader_"+g),i.setRequestHeader("x-ig-app-id","1217981644879628"),i.setRequestHeader("x-instagram-rupload-params",JSON.stringify({media_type:1,upload_id:g,upload_media_height:f,upload_media_width:e})),i.setRequestHeader("offset",0),i.onload=function(){try{var a=JSON.parse(this.responseText)}catch(b){return c({error:1,status:200})}c(a)},i.send(a)}})},configurePhoto:function(a,b){var c=a.caption,d=a.uploadId,e=a.uploadType,f=a.usertags;chrome.runtime.sendMessage("getCookies",function(a){if(a){var g={upload_id:d,caption:c};f&&(g.usertags=JSON.stringify({"in":f}));var h="https://www.instagram.com/create/"+("profile"==e?"configure/":"configure_to_story/");$.ajax({url:h,method:"POST",data:g,headers:{"x-csrftoken":a.csrftoken,"x-ig-app-id":"1217981644879628"}}).done(function(a){return a&&"object"==typeof a&&"ok"==a.status?void b({success:1}):b({error:1,res:a,status:200})}).fail(function(a){b({error:1,res:a.responseJSON,status:a.status})})}})},handleBadResponse:function(b){var c,d=chrome.i18n.getMessage("upload_error"),e=chrome.i18n.getMessage("error403_possible_reasons"),f=chrome.i18n.getMessage("error403_reason_1"),g=chrome.i18n.getMessage("error403_reason_2"),h=chrome.i18n.getMessage("error_network"),i=chrome.i18n.getMessage("check_network"),j=chrome.i18n.getMessage("error_reason_xz");c="403"==b.status?'<h3 style="margin-bottom:15px;font-weight:600;">'+d+'</h3><p style="margin-bottom:10px;">'+e+':</p><ol style="text-align: justify; list-style: decimal;padding: 10px;margin-left: 10px;font-size: 0.8em;"><li style="margin-bottom:15px">'+f+'</li><li style="margin-bottom:15px">'+g+"</li></ol>":"0"==b.status&&"undefined"==typeof b.res?'<h3 style="margin-bottom: 15px;font-weight: 600;">'+h+"</h3><p>"+i+"</p>":'<h3 style="margin-bottom: 15px;font-weight: 600;">'+d+"</h3><p>"+j+"</p>";var k=a.getModalBox();k.showErrorBox(c)}},uploadPreviewBlock:{btnNextLastClickTime:0,croppieObj:null,imgSrc:null,width:null,height:null,currentTransformation:null,currentSize:{},currentRotate:0,container:null,create:function(a){var c=this,d=document.querySelector("section > main > div");if(!d)return null;var e=b.uploadType,f=document.createElement("div");f.className="upload_preview_wrap",c.container=f;var g=chrome.i18n.getMessage("write_caption"),h=chrome.i18n.getMessage("next"),i=chrome.i18n.getMessage("new_post"),j=chrome.i18n.getMessage("new_story"),k=chrome.i18n.getMessage("btn_cancel"),l='<div class="upload_preview_header"><button class="cancel">'+k+'</button><span class="text">'+i+'</span><button class="next">'+h+'</button></div><div class="upload_content"><textarea maxlength="2000" placeholder="'+g+'"></textarea><div class="tag_people_btn_wrap"><button class="tag_people_btn"><span class="tag_people_btn_text"></span><span class="coreSpriteNotificationRightChevron"></span></button></div><div class="tag_people_header"><button class="ext_tag_people_close"><span class="coreSpriteClose"></span></button><span class="tag_people_header_text"></span><button class="tag_people_confirm_btn"></button></div><div class="upload_preview_img"><div class="rotate_btn"></div><div class="expand_btn"></div></div><div class="uploaded_image_preview"></div><div class="tag_people_msg"><div></div></div><img id="img_hidden"></div>',m='<div class="upload_preview_header"><button class="cancel">'+k+'</button><span class="text">'+j+'</span><button class="next">'+h+'</button></div><div class="upload_content"><div class="upload_preview_img"><div class="rotate_btn"></div></div><div class="uploaded_image_preview"></div><img id="img_hidden"></div>';f.innerHTML="profile"==e?l:m;var n=d.querySelector("header + div");if(n||(n=d.querySelector("header + article")),n)d.insertBefore(f,n);else{var o=[];d.children.forEach(function(a){o.push(a.tagName+"_"+a.className)}),d.appendChild(f)}var p=f.querySelector(".cancel"),q=f.querySelector(".next"),r=f.querySelector(".expand_btn"),s=f.querySelector(".rotate_btn"),t=f.querySelector(".upload_preview_img"),u=f.querySelector("#img_hidden");c.imgDiv=t,p.addEventListener("click",c.onCancelBtnClick),q.addEventListener("click",c.onFirstNextClick.bind(c)),this.imgSrc=a,u.onload=function(){f.style.display="block",t.style.display="block",c.width=u.naturalWidth,c.height=u.naturalHeight,"profile"==e?(c.width!=c.height?r.style.display="block":r.style.display="none",r.addEventListener("click",c.resizeImage.bind(c)),s.addEventListener("click",c.rotateImage.bind(c)),c.squareTransformation()):(s.addEventListener("click",c.rotateImage.bind(c)),c.rectangleStoryTransformation()),f.style.display="flex"},u.src=a},onCancelBtnClick:function(){b.stateReset()},destroySelf:function(){var a=document.querySelector(".upload_preview_wrap");a&&a.remove()},createCroppieObj:function(a,b,c){var d=document.querySelector(".upload_preview_img"),e=this;e.croppieObj=new Croppie(d,{viewport:a,boundary:{width:400,height:400},enableZoom:!0,enableOrientation:!0,showZoomer:!1,update:function(a){e.currentSize.width=a.points[2]-a.points[0],e.currentSize.height=a.points[3]-a.points[1]}});var f={url:e.imgSrc,points:b};c&&(f.orientation=6),e.croppieObj.bind(f)},destroyCroppieObj:function(){this.croppieObj&&(this.croppieObj.destroy(),this.croppieObj=null)},squareTransformation:function(){var a=this;this.destroyCroppieObj();var b=a.width,c=a.height;a.currentTransformation="square";var d,e,f,g;b==c?(d=0,e=0,f=b,g=c):b>c?(e=0,g=c,d=b/2-c/2,f=d+c):(d=0,f=b,e=c/2-b/2,g=e+b);var h=[d,e,f,g];a.createCroppieObj({width:350,height:350},h)},rectangleTransformation:function(){var a=this;a.destroyCroppieObj(),a.currentTransformation="rectangle";var b,c,d,e,f,g,h,i=a.width,j=a.height,k=.8,l=1.911,m=i/j,n={};i>j?l>=m?(c=0,e=j,b=0,d=i,n.width=350,n.height=350/m):(c=0,e=j,g=j*l,f=i/2,b=f-g/2,d=b+g,n.width=350,n.height=350/l):m>=k?(c=0,e=j,b=0,d=i,n.height=350,n.width=350*m):(h=i/k,f=j/2,c=f-h/2,e=c+h,b=0,d=i,n.width=350*k,n.height=350);var o=[b,c,d,e];a.createCroppieObj(n,o)},rectangleStoryTransformation:function(){var a=this;a.destroyCroppieObj(),a.currentTransformation="rectangle_vertical";var b=a.width,c=a.height,d=!1;b>c&&(d=!0,a.width=c,a.height=b,b=a.width,c=a.height);var e,f,g,h,i,j,k,l=c/b,m=1.77,n=1.78,o={height:350,width:350/l};f=0,e=0,h=c,g=b,l>=n&&(k=b*n,i=c/2,f=i-k/2,h=f+k,o.width=350/n),m>=l&&(j=c/m,i=b/2,e=i-j/2,g=e+j,o.width=350/m);var p=[e,f,g,h];a.createCroppieObj(o,p,d)},resizeImage:function(){"square"==this.currentTransformation?this.rectangleTransformation():this.squareTransformation()},rotateImage:function(){this.croppieObj&&this.croppieObj.rotate(90)},getOptimalSize:function(){if(null!==b.size)return b.size;var a=this.currentSize;if(!a.width||!a.height)return b.size=null,b.size;var c;if("profile"==b.uploadType){var d=1080,e=1080,f=+(a.height>a.width);f?(c=a.height/d,b.size={height:d,width:Math.floor(a.width/c)}):(c=a.width/e,b.size={width:e,height:Math.floor(a.height/c)})}else{var g=1080;c=a.width/g,b.size={width:g,height:Math.floor(a.height/c)}}return b.size},getBlobPreview:function(a){this.croppieObj||a();var b=this.getOptimalSize(),c={type:"blob",format:"jpeg",size:"original"};b&&(c.size=b),this.croppieObj.result(c).then(a)},showLoader:function(a){a.innerText="",a.classList.add("loader")},hideLoader:function(a){a.innerText=chrome.i18n.getMessage("next"),a.classList.remove("loader")},showUploadedImage:function(a){var b=document.querySelector(".uploaded_image_preview"),c=document.querySelector(".upload_preview_img");c.style.display="none";var d=new FileReader;d.readAsDataURL(a),d.onload=function(){var a=d.result;b.style.backgroundImage="url("+a+")",b.style.display="block"}},showTextarea:function(){var a=this.container.querySelector("textarea");a.removeAttribute("disabled"),a.innerText="",a.style.display="block"},showTagPeopleBtn:function(){var a=document.querySelector(".tag_people_btn_wrap"),b=a.querySelector(".tag_people_btn");b.querySelector(".tag_people_btn_text").innerText=chrome.i18n.getMessage("tag_people"),b.addEventListener("click",this.tagPeople.init.bind(this.tagPeople)),a.style.display="flex"},tagPeople:{usertags:[],listenersAdded:!1,opened:!1,init:function(){this.showTagPeoplePanel(),this.listenersAdded||this.addListeners(),this.opened=!0},addListeners:function(){var a=this,b=$(".uploaded_image_preview");b.on("click",function(b){a.previewImageClick(b,this)}),b.on("click",".ext_user_tag_wrap",this.tagLabelClick),b.on("click","#ext_deleteButton",this.removeTagClick),document.querySelector(".ext_tag_people_close").addEventListener("click",function(){a.usertags.forEach(function(a){$('[data-user_pk="'+a.user_id+'"]').remove()}),a.close()}),document.querySelector(".tag_people_confirm_btn").addEventListener("click",this.tagPeopleConfirm.bind(this)),this.listenersAdded=!0},previewImageClick:function(a,b){if(this.opened){var c=[a.offsetX/b.offsetWidth,a.offsetY/b.offsetHeight];this.usersList.showBox(c)}},tagLabelClick:function(a){var c=b.uploadPreviewBlock.tagPeople;if(this.self){a.stopPropagation(),a.preventDefault();var d=this.querySelector("#ext_deleteButton");d?d.remove():$(this.querySelector("button")).append(c.getDeleteBtn())}},removeTagClick:function(a){a.stopPropagation(),a.preventDefault();for(var c=b.uploadPreviewBlock.tagPeople,d=$(this).closest(".ext_user_tag_wrap"),e=d.data().user_pk,f=0;f<c.usertags.length;f++)if(c.usertags[f].user_id==e){c.usertags.splice(f,1);break}d.remove()},showTagPeoplePanel:function(){document.querySelector(".tag_people_btn_wrap").style.display="none",document.querySelector(".upload_preview_header").style.display="none",document.querySelector(".upload_content textarea").style.display="none";var a=document.querySelector(".tag_people_header");a.querySelector(".tag_people_header_text").innerText=chrome.i18n.getMessage("tag_people"),a.style.display="flex";var b=a.querySelector(".tag_people_confirm_btn");b.innerText=chrome.i18n.getMessage("tag_people_confirm");var c=document.querySelector(".tag_people_msg");c.querySelector("div").innerText=chrome.i18n.getMessage("tag_people_msg"),c.style.display="flex"},close:function(){$(".tag_people_header").hide(),$(".upload_preview_header").show(),$(".tag_people_btn_wrap").show(),$(".upload_content textarea").show(),this.usertags=[],this.opened=!1},tagPeopleConfirm:function(a){b.confirmedUsertags=b.confirmedUsertags.concat(this.usertags),this.close()},createUserTag:function(a){return $('<div class="ext_user_tag_wrap" data-user_pk="'+a.user_pk+'" style="left:'+a.left+"%;top: "+a.top+'%"><button><div class="ext_tag_tip"></div><span class="ext_tag_name">'+a.username+"</span></button></div>")},getDeleteBtn:function(){return $('<span id="ext_deleteButton" class="coreSpriteSearchClear"></span>')},usersList:{suggestedUsers:null,showBox:function(c){var d=this,e=b.uploadPreviewBlock.tagPeople,f=a.getModalBox();f.showUsersListSearch();var g=$(".ext_users_search_list");g.addClass("ext_loader"),g.on("click",".ext_users_search_item",function(a){f.close();for(var b=0;b<e.usertags.length;b++)if(e.usertags[b].user_id==this.dataset.user_pk){e.usertags.splice(b,1),$('[data-user_pk="'+this.dataset.user_pk+'"]').remove();break}e.usertags.push({user_id:this.dataset.user_pk,position:c}),$(".uploaded_image_preview").append(e.createUserTag({left:100*c[0],top:100*c[1],username:this.dataset.username,user_pk:this.dataset.user_pk}))}),this.createSearchInputBlock(),this.requestSuggested({},function(a){a.error||!a.edges,d.renderUsersList(a.edges,g)})},requestSuggested:function(a,b){var c=this;if(c.suggestedUsers)return b({edges:c.suggestedUsers});var d="7616ef507122e253e5c7806f7976f05c",e="https://www.instagram.com/graphql/query/?query_hash="+d+"&variables="+encodeURIComponent("{}");$.ajax({url:e,method:"GET"}).done(function(a){if(!a||!a.data)return b({error:1});var d=[];try{d=a.data.user.null_state.edge_suggested.edges,c.suggestedUsers=d}catch(e){return b({error:1})}b({edges:d})}).fail(function(){b({error:1})})},requestTopSearch:function(a,b){var c=encodeURIComponent(a.query),d="https://www.instagram.com/web/search/topsearch/?context=user&query="+c+"&rank_token="+Math.random()+"&include_reel=true";$.get(d).done(function(a){return a&&a.users&&a.users.length?void b({users:a.users}):b({error:1})}).fail(function(){b({error:1})})},renderUsersList:function(a,b){if(b.removeClass("ext_loader"),a&&a.length&&b.length)try{for(var c=0;c<a.length;c++){if(a[c].node&&a[c].node.user)var d=this.createSearchDOMitem(a[c].node.user);else{if(!a[c].user)return;d=this.createSearchDOMitem(a[c].user)}b.append(d)}}catch(e){}},createSearchInputBlock:function(){var a=this,b=document.querySelector(".ext_users_search_wrap"),c=chrome.i18n.getMessage("enter_search_query");b.innerHTML='<label class="ext_users_search_label"><input autocapitalize="none" autocomplete="off" class="ext_users_search_input" placeholder="" type="search" value=""><div class="ext_users_search_input_placeholder"><div class="ext_users_search_input_placeholder_icon_wrap"><span class="glyphsSpriteSearch" aria-label="'+c+'"></span></div><span class="ext_users_search_input_placeholder_text">'+c+'</span></div><div class="ext_users_search_input_placeholder_lock"></div></label>';var d=null,e=$(".ext_users_search_list");b.querySelector(".ext_users_search_input").addEventListener("input",function(c){var f=this;f.value.length>0?b.querySelector(".ext_users_search_input_placeholder").style.opacity="0":b.querySelector(".ext_users_search_input_placeholder").style.opacity="1",d&&clearTimeout(d),d=setTimeout(function(){d=null,e.html("").addClass("ext_loader"),f.value.length>0?a.onSearchEnter(f.value,e):a.renderUsersList(a.suggestedUsers,e)},300)})},createSearchDOMitem:function(a){var b=document.createElement("div");return b.dataset.user_pk=a.pk,b.dataset.username=a.username,b.className="ext_users_search_item",b.innerHTML='<span class="ext_user_icon"><img src="'+a.profile_pic_url+'"></span><div class="ext_user_data"><div class="ext_username"><span>'+a.username+"</span>"+(a.is_verified?'<div class="coreSpriteVerifiedBadgeSmall"></div>':"")+'</div><div class="ext_userfullname">'+a.full_name+"</div></div>",b},onSearchEnter:function(a,b){var c=this;c.requestTopSearch({query:a},function(a){a&&a.users&&c.renderUsersList(a.users,b)})}}},addNewNextBtn:function(){var a=this.container.querySelector(".upload_preview_header"),b=a.querySelector(".next");b.remove();var c=document.createElement("button");c.className="next",c.innerText=chrome.i18n.getMessage("next"),a.appendChild(c),c.addEventListener("click",this.onSecondNextClick.bind(this))},onFirstNextClick:function(){var a=Date.now();if(!(a<this.btnNextLastClickTime+500)){var c=document.querySelector(".next");this.btnNextLastClickTime=a,this.showLoader(c);var d=this;this.getBlobPreview(function(a){b.uploadRequest.factory("photo",a,function(b){d.addNewNextBtn(),d.showUploadedImage(a),d.showTextarea(),d.showTagPeopleBtn()})})}},onSecondNextClick:function(){var a=Date.now();if(!(a<this.btnNextLastClickTime+500)){var c=document.querySelector(".next");this.btnNextLastClickTime=a,this.showLoader(c),this.showLoader(c);var d=this.container.querySelector("textarea");d.setAttribute("disabled","disabled");var e=d.value;b.uploadRequest.factory("caption",e)}}},addDeleteBtnToThumbnail:function(a){var b=a.parentNode;if(!b.querySelector(".coreSpriteSidecarIconLarge")&&!b.querySelector(".coreSpriteVideoIconLarge")){var c=a.href.match(/\/p\/([^\/]+)/);if(c=c&&c[1]){var d=this.getDelBtnEl(c);b.appendChild(d),b.dataset.dlBtnSkip="1"}}},deleteMedia:function(b){return function(c){function d(){c||(c=a.getModalBox()),e||(e=c.querySelector(".ext_modal_buttons_wrap")),e.style.display="none",f||(f=document.createElement("span"),f.className="ext_delete_loader",e.parentNode.appendChild(f)),f.style.display="block"}var e,f,g=chrome.i18n.getMessage("delete_error"),h=chrome.i18n.getMessage("error403_possible_reasons"),i=chrome.i18n.getMessage("error403_reason_1"),j=chrome.i18n.getMessage("error403_reason_2"),k=chrome.i18n.getMessage("error_network"),l=chrome.i18n.getMessage("check_network"),m=chrome.i18n.getMessage("error_reason_xz"),n='<h3 style="margin-bottom: 15px;font-weight: 600;">'+g+"</h3><p>"+m+"</p>";d(),chrome.runtime.sendMessage("getCookies",function(d){return d&&d.csrftoken?void a.requestJSONgraphqlByShortCode({shortCode:b},function(a){if(!a||a.error){var b=n;return b+='<div class="delete_by_mobile_mode"><a href="">'+chrome.i18n.getMessage("delete_by_mobile_mode")+'<span class="icon"></span></a></div>',void c.showErrorBox(b)}try{var e=a.graphql.shortcode_media.id,f="https://www.instagram.com/create/"+e+"/delete/"}catch(m){return b=n,b+='<div class="delete_by_mobile_mode"><a href="">'+chrome.i18n.getMessage("delete_by_mobile_mode")+'<span class="icon"></span></a></div>',void c.showErrorBox(b)}$.ajax({url:f,method:"POST",headers:{"x-csrftoken":d.csrftoken,"x-instagram-ajax":"1"}}).done(function(a){return a&&"object"==typeof a&&"ok"==a.status&&"undefined"!=typeof a.did_delete?0==a.did_delete?c.showErrorBox(n):void window.location.reload():c.showErrorBox(n)}).fail(function(a){if(403==a.status)var b='<h3 style="margin-bottom:15px;font-weight:600;">'+g+'</h3><p style="margin-bottom:10px;">'+h+':</p><ol style="text-align: justify; list-style: decimal;padding: 10px;margin-left: 10px;font-size: 0.8em;"><li style="margin-bottom:15px">'+i+'</li><li style="margin-bottom:15px">'+j+"</li></ol>";else b=0==a.status?'<h3 style="margin-bottom: 15px;font-weight: 600;">'+k+"</h3><p>"+l+"</p>":n;c.showErrorBox(b)})}):void c.showErrorBox(n)})}},getDelBtnEl:function(a){this.delButtonTemplate||(this.delButtonTemplate=this.createDelBtnTemplate());var b=this.delButtonTemplate.cloneNode(!0);return b.setAttribute("type","button"),b.dataset.shortcode=a,b.classList.add(this.delBtnClassName),b},createDelBtnTemplate:function(){var a=document.createElement("a");return a.innerHTML='<span class="delete_icon"></span>',a}}}();$(function(){a.run()})}();